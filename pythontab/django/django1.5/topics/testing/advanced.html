
<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->

<!-- Mirrored from docs.pythontab.com/django/django1.5/topics/testing/advanced.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 04 Oct 2022 03:53:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Advanced testing topics &mdash; Django 中文手册 1.5 documentation</title>
  
  
  
    
  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  
  
   
  <script src="../../_static/js/modernizr.min.js"></script>
</head>
<body class="wy-body-for-nav" role="document">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../contents.html" class="icon icon-home"> Django 中文手册
          

          
          </a>

          
            
            
              <div class="version">
                1.5
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://docs.pythontab.com/django/django1.5/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../../index-2.html">Django 中文文档</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../intro/index.html">新手入门</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">使用 Django</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../install.html">如何安装 Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../db/index.html">Models and databases</a></li>
<li class="toctree-l2"><a class="reference internal" href="../http/index.html">Handling HTTP requests</a></li>
<li class="toctree-l2"><a class="reference internal" href="../forms/index.html">Working with forms</a></li>
<li class="toctree-l2"><a class="reference internal" href="../templates.html">The Django template language</a></li>
<li class="toctree-l2"><a class="reference internal" href="../class-based-views/index.html">Class-based views</a></li>
<li class="toctree-l2"><a class="reference internal" href="../files.html">Managing files</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Testing in Django</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="overview.html">Testing Django applications</a></li>
<li class="toctree-l3"><a class="reference internal" href="doctests.html">Django and doctests</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Advanced testing topics</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-django.test.client">The request factory</a></li>
<li class="toctree-l4"><a class="reference internal" href="#tests-and-multiple-databases">Tests and multiple databases</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-tests-outside-the-test-runner">Running tests outside the test runner</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-different-testing-frameworks">Using different testing frameworks</a></li>
<li class="toctree-l4"><a class="reference internal" href="#integration-with-coverage-py">Integration with coverage.py</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#unit-tests-v-doctests">Unit tests v. doctests</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#where-to-go-from-here">Where to go from here</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../auth/index.html">User authentication in Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cache.html">Django&#8217;s cache framework</a></li>
<li class="toctree-l2"><a class="reference internal" href="../conditional-view-processing.html">Conditional View Processing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../signing.html">Cryptographic signing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../email.html">Sending email</a></li>
<li class="toctree-l2"><a class="reference internal" href="../i18n/index.html">Internationalization and localization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../logging.html">Logging</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pagination.html">Pagination</a></li>
<li class="toctree-l2"><a class="reference internal" href="../python3.html">Porting to Python 3</a></li>
<li class="toctree-l2"><a class="reference internal" href="../security.html">Security in Django</a></li>
<li class="toctree-l2"><a class="reference internal" href="../serialization.html">Serializing Django objects</a></li>
<li class="toctree-l2"><a class="reference internal" href="../settings.html">Django settings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../signals.html">Signals</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../howto/index.html">&#8220;How-to&#8221; guides</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Django FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref/index.html">API 参考</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../misc/index.html">Meta-documentation and miscellany</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary.html">Glossary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../releases/index.html">Release notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internals/index.html">Django internals</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../contents.html">Django 中文手册</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../contents.html"> &mdash; Django 中文手册 1.5 documentation</a> &raquo;</li>
      
          <li><a href="../index.html">使用 Django</a> &raquo;</li>
      
          <li><a href="index.html">Testing in Django</a> &raquo;</li>
      
    <li>Advanced testing topics</li>
      <li class="wy-breadcrumbs-aside">
        
            <a href="../../../../index.html" class="fa fa-github"> 在线手册中心</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="advanced-testing-topics">
<h1>Advanced testing topics<a class="headerlink" href="#advanced-testing-topics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-django.test.client">
<span id="the-request-factory"></span><h2>The request factory<a class="headerlink" href="#module-django.test.client" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="django.test.client.RequestFactory">
<em class="property">class </em><code class="descname">RequestFactory</code><a class="headerlink" href="#django.test.client.RequestFactory" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="#django.test.client.RequestFactory" title="django.test.client.RequestFactory"><code class="xref py py-class docutils literal"><span class="pre">RequestFactory</span></code></a> shares the same API as
the test client. However, instead of behaving like a browser, the
RequestFactory provides a way to generate a request instance that can
be used as the first argument to any view. This means you can test a
view function the same way as you would test any other function &#8211; as
a black box, with exactly known inputs, testing for specific outputs.</p>
<p>The API for the <a class="reference internal" href="#django.test.client.RequestFactory" title="django.test.client.RequestFactory"><code class="xref py py-class docutils literal"><span class="pre">RequestFactory</span></code></a> is a slightly
restricted subset of the test client API:</p>
<ul class="simple">
<li>It only has access to the HTTP methods <a class="reference internal" href="overview.html#django.test.client.Client.get" title="django.test.client.Client.get"><code class="xref py py-meth docutils literal"><span class="pre">get()</span></code></a>,
<a class="reference internal" href="overview.html#django.test.client.Client.post" title="django.test.client.Client.post"><code class="xref py py-meth docutils literal"><span class="pre">post()</span></code></a>, <a class="reference internal" href="overview.html#django.test.client.Client.put" title="django.test.client.Client.put"><code class="xref py py-meth docutils literal"><span class="pre">put()</span></code></a>,
<a class="reference internal" href="overview.html#django.test.client.Client.delete" title="django.test.client.Client.delete"><code class="xref py py-meth docutils literal"><span class="pre">delete()</span></code></a>, <a class="reference internal" href="overview.html#django.test.client.Client.head" title="django.test.client.Client.head"><code class="xref py py-meth docutils literal"><span class="pre">head()</span></code></a> and
<a class="reference internal" href="overview.html#django.test.client.Client.options" title="django.test.client.Client.options"><code class="xref py py-meth docutils literal"><span class="pre">options()</span></code></a>.</li>
<li>These methods accept all the same arguments <em>except</em> for
<code class="docutils literal"><span class="pre">follows</span></code>. Since this is just a factory for producing
requests, it&#8217;s up to you to handle the response.</li>
<li>It does not support middleware. Session and authentication
attributes must be supplied by the test itself if required
for the view to function properly.</li>
</ul>
<div class="section" id="example">
<h3>Example<a class="headerlink" href="#example" title="Permalink to this headline">¶</a></h3>
<p>The following is a simple unit test using the request factory:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">unittest</span>
<span class="kn">from</span> <span class="nn">django.test.client</span> <span class="kn">import</span> <span class="n">RequestFactory</span>

<span class="k">class</span> <span class="nc">SimpleTest</span><span class="p">(</span><span class="n">unittest</span><span class="o">.</span><span class="n">TestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">setUp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Every test needs access to the request factory.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">factory</span> <span class="o">=</span> <span class="n">RequestFactory</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">test_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c"># Create an instance of a GET request.</span>
        <span class="n">request</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">factory</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;/customer/details&#39;</span><span class="p">)</span>

        <span class="c"># Test my_view() as if it were deployed at /customer/details</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="tests-and-multiple-databases">
<span id="topics-testing-advanced-multidb"></span><h2>Tests and multiple databases<a class="headerlink" href="#tests-and-multiple-databases" title="Permalink to this headline">¶</a></h2>
<div class="section" id="testing-master-slave-configurations">
<span id="topics-testing-masterslave"></span><h3>Testing master/slave configurations<a class="headerlink" href="#testing-master-slave-configurations" title="Permalink to this headline">¶</a></h3>
<p>If you&#8217;re testing a multiple database configuration with master/slave
replication, this strategy of creating test databases poses a problem.
When the test databases are created, there won&#8217;t be any replication,
and as a result, data created on the master won&#8217;t be seen on the
slave.</p>
<p>To compensate for this, Django allows you to define that a database is
a <em>test mirror</em>. Consider the following (simplified) example database
configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;myproject&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;dbmaster&#39;</span><span class="p">,</span>
         <span class="c"># ... plus some other settings</span>
    <span class="p">},</span>
    <span class="s">&#39;slave&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s">&#39;django.db.backends.mysql&#39;</span><span class="p">,</span>
        <span class="s">&#39;NAME&#39;</span><span class="p">:</span> <span class="s">&#39;myproject&#39;</span><span class="p">,</span>
        <span class="s">&#39;HOST&#39;</span><span class="p">:</span> <span class="s">&#39;dbslave&#39;</span><span class="p">,</span>
        <span class="s">&#39;TEST_MIRROR&#39;</span><span class="p">:</span> <span class="s">&#39;default&#39;</span>
        <span class="c"># ... plus some other settings</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In this setup, we have two database servers: <code class="docutils literal"><span class="pre">dbmaster</span></code>, described
by the database alias <code class="docutils literal"><span class="pre">default</span></code>, and <code class="docutils literal"><span class="pre">dbslave</span></code> described by the
alias <code class="docutils literal"><span class="pre">slave</span></code>. As you might expect, <code class="docutils literal"><span class="pre">dbslave</span></code> has been configured
by the database administrator as a read slave of <code class="docutils literal"><span class="pre">dbmaster</span></code>, so in
normal activity, any write to <code class="docutils literal"><span class="pre">default</span></code> will appear on <code class="docutils literal"><span class="pre">slave</span></code>.</p>
<p>If Django created two independent test databases, this would break any
tests that expected replication to occur. However, the <code class="docutils literal"><span class="pre">slave</span></code>
database has been configured as a test mirror (using the
<a class="reference internal" href="../../ref/settings.html#std:setting-TEST_MIRROR"><code class="xref std std-setting docutils literal"><span class="pre">TEST_MIRROR</span></code></a> setting), indicating that under testing,
<code class="docutils literal"><span class="pre">slave</span></code> should be treated as a mirror of <code class="docutils literal"><span class="pre">default</span></code>.</p>
<p>When the test environment is configured, a test version of <code class="docutils literal"><span class="pre">slave</span></code>
will <em>not</em> be created. Instead the connection to <code class="docutils literal"><span class="pre">slave</span></code>
will be redirected to point at <code class="docutils literal"><span class="pre">default</span></code>. As a result, writes to
<code class="docutils literal"><span class="pre">default</span></code> will appear on <code class="docutils literal"><span class="pre">slave</span></code> &#8211; but because they are actually
the same database, not because there is data replication between the
two databases.</p>
</div>
<div class="section" id="controlling-creation-order-for-test-databases">
<span id="topics-testing-creation-dependencies"></span><h3>Controlling creation order for test databases<a class="headerlink" href="#controlling-creation-order-for-test-databases" title="Permalink to this headline">¶</a></h3>
<p>By default, Django will always create the <code class="docutils literal"><span class="pre">default</span></code> database first.
However, no guarantees are made on the creation order of any other
databases in your test setup.</p>
<p>If your database configuration requires a specific creation order, you
can specify the dependencies that exist using the
<a class="reference internal" href="../../ref/settings.html#std:setting-TEST_DEPENDENCIES"><code class="xref std std-setting docutils literal"><span class="pre">TEST_DEPENDENCIES</span></code></a> setting. Consider the following
(simplified) example database configuration:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="c"># ... db settings</span>
         <span class="s">&#39;TEST_DEPENDENCIES&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;diamonds&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s">&#39;diamonds&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c"># ... db settings</span>
    <span class="p">},</span>
    <span class="s">&#39;clubs&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c"># ... db settings</span>
        <span class="s">&#39;TEST_DEPENDENCIES&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;diamonds&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s">&#39;spades&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c"># ... db settings</span>
        <span class="s">&#39;TEST_DEPENDENCIES&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;diamonds&#39;</span><span class="p">,</span><span class="s">&#39;hearts&#39;</span><span class="p">]</span>
    <span class="p">},</span>
    <span class="s">&#39;hearts&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="c"># ... db settings</span>
        <span class="s">&#39;TEST_DEPENDENCIES&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s">&#39;diamonds&#39;</span><span class="p">,</span><span class="s">&#39;clubs&#39;</span><span class="p">]</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Under this configuration, the <code class="docutils literal"><span class="pre">diamonds</span></code> database will be created first,
as it is the only database alias without dependencies. The <code class="docutils literal"><span class="pre">default</span></code> and
<code class="docutils literal"><span class="pre">clubs</span></code> alias will be created next (although the order of creation of this
pair is not guaranteed); then <code class="docutils literal"><span class="pre">hearts</span></code>; and finally <code class="docutils literal"><span class="pre">spades</span></code>.</p>
<p>If there are any circular dependencies in the
<a class="reference internal" href="../../ref/settings.html#std:setting-TEST_DEPENDENCIES"><code class="xref std std-setting docutils literal"><span class="pre">TEST_DEPENDENCIES</span></code></a> definition, an <code class="docutils literal"><span class="pre">ImproperlyConfigured</span></code>
exception will be raised.</p>
</div>
</div>
<div class="section" id="running-tests-outside-the-test-runner">
<h2>Running tests outside the test runner<a class="headerlink" href="#running-tests-outside-the-test-runner" title="Permalink to this headline">¶</a></h2>
<p>If you want to run tests outside of <code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">test</span></code> &#8211; for example,
from a shell prompt &#8211; you will need to set up the test
environment first. Django provides a convenience method to do this:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">setup_test_environment</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">setup_test_environment</span><span class="p">()</span>
</pre></div>
</div>
<p>This convenience method sets up the test database, and puts other
Django features into modes that allow for repeatable testing.</p>
<p>The call to <a class="reference internal" href="#django.test.utils.setup_test_environment" title="django.test.utils.setup_test_environment"><code class="xref py py-meth docutils literal"><span class="pre">setup_test_environment()</span></code></a> is made
automatically as part of the setup of <code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">test</span></code>. You only
need to manually invoke this method if you&#8217;re not using running your
tests via Django&#8217;s test runner.</p>
</div>
<div class="section" id="using-different-testing-frameworks">
<span id="other-testing-frameworks"></span><h2>Using different testing frameworks<a class="headerlink" href="#using-different-testing-frameworks" title="Permalink to this headline">¶</a></h2>
<p>Clearly, <a class="reference external" href="http://docs.python.org/2.7/library/doctest.html#module-doctest" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">doctest</span></code></a> and <a class="reference external" href="http://docs.python.org/2.7/library/unittest.html#module-unittest" title="(in Python v2.7)"><code class="xref py py-mod docutils literal"><span class="pre">unittest</span></code></a> are not the only Python testing
frameworks. While Django doesn&#8217;t provide explicit support for alternative
frameworks, it does provide a way to invoke tests constructed for an
alternative framework as if they were normal Django tests.</p>
<p>When you run <code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">test</span></code>, Django looks at the <a class="reference internal" href="../../ref/settings.html#std:setting-TEST_RUNNER"><code class="xref std std-setting docutils literal"><span class="pre">TEST_RUNNER</span></code></a>
setting to determine what to do. By default, <a class="reference internal" href="../../ref/settings.html#std:setting-TEST_RUNNER"><code class="xref std std-setting docutils literal"><span class="pre">TEST_RUNNER</span></code></a> points to
<code class="docutils literal"><span class="pre">'django.test.simple.DjangoTestSuiteRunner'</span></code>. This class defines the default Django
testing behavior. This behavior involves:</p>
<ol class="arabic simple">
<li>Performing global pre-test setup.</li>
<li>Looking for unit tests and doctests in the <code class="docutils literal"><span class="pre">models.py</span></code> and
<code class="docutils literal"><span class="pre">tests.py</span></code> files in each installed application.</li>
<li>Creating the test databases.</li>
<li>Running <code class="docutils literal"><span class="pre">syncdb</span></code> to install models and initial data into the test
databases.</li>
<li>Running the unit tests and doctests that are found.</li>
<li>Destroying the test databases.</li>
<li>Performing global post-test teardown.</li>
</ol>
<p>If you define your own test runner class and point <a class="reference internal" href="../../ref/settings.html#std:setting-TEST_RUNNER"><code class="xref std std-setting docutils literal"><span class="pre">TEST_RUNNER</span></code></a> at
that class, Django will execute your test runner whenever you run
<code class="docutils literal"><span class="pre">./manage.py</span> <span class="pre">test</span></code>. In this way, it is possible to use any test framework
that can be executed from Python code, or to modify the Django test execution
process to satisfy whatever testing requirements you may have.</p>
<div class="section" id="defining-a-test-runner">
<span id="topics-testing-test-runner"></span><h3>Defining a test runner<a class="headerlink" href="#defining-a-test-runner" title="Permalink to this headline">¶</a></h3>
<p>A test runner is a class defining a <code class="docutils literal"><span class="pre">run_tests()</span></code> method. Django ships
with a <code class="docutils literal"><span class="pre">DjangoTestSuiteRunner</span></code> class that defines the default Django
testing behavior. This class defines the <code class="docutils literal"><span class="pre">run_tests()</span></code> entry point,
plus a selection of other methods that are used to by <code class="docutils literal"><span class="pre">run_tests()</span></code> to
set up, execute and tear down the test suite.</p>
<dl class="class">
<dt id="django.test.simple.DjangoTestSuiteRunner">
<em class="property">class </em><code class="descname">DjangoTestSuiteRunner</code><span class="sig-paren">(</span><em>verbosity=1</em>, <em>interactive=True</em>, <em>failfast=True</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner" title="Permalink to this definition">¶</a></dt>
<dd><p><code class="docutils literal"><span class="pre">verbosity</span></code> determines the amount of notification and debug information
that will be printed to the console; <code class="docutils literal"><span class="pre">0</span></code> is no output, <code class="docutils literal"><span class="pre">1</span></code> is normal
output, and <code class="docutils literal"><span class="pre">2</span></code> is verbose output.</p>
<p>If <code class="docutils literal"><span class="pre">interactive</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, the test suite has permission to ask the
user for instructions when the test suite is executed. An example of this
behavior would be asking for permission to delete an existing test
database. If <code class="docutils literal"><span class="pre">interactive</span></code> is <code class="docutils literal"><span class="pre">False</span></code>, the test suite must be able to
run without any manual intervention.</p>
<p>If <code class="docutils literal"><span class="pre">failfast</span></code> is <code class="docutils literal"><span class="pre">True</span></code>, the test suite will stop running after the
first test failure is detected.</p>
<p>Django will, from time to time, extend the capabilities of
the test runner by adding new arguments. The <code class="docutils literal"><span class="pre">**kwargs</span></code> declaration
allows for this expansion. If you subclass <code class="docutils literal"><span class="pre">DjangoTestSuiteRunner</span></code> or
write your own test runner, ensure accept and handle the <code class="docutils literal"><span class="pre">**kwargs</span></code>
parameter.</p>
<div class="versionadded">
</div>
<p>Your test runner may also define additional command-line options.
If you add an <code class="docutils literal"><span class="pre">option_list</span></code> attribute to a subclassed test runner,
those options will be added to the list of command-line options that
the <a class="reference internal" href="../../ref/django-admin.html#django-admin-test"><code class="xref std std-djadmin docutils literal"><span class="pre">test</span></code></a> command can use.</p>
</dd></dl>

<div class="section" id="attributes">
<h4>Attributes<a class="headerlink" href="#attributes" title="Permalink to this headline">¶</a></h4>
<dl class="attribute">
<dt id="django.test.simple.DjangoTestSuiteRunner.option_list">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">option_list</code><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.option_list" title="Permalink to this definition">¶</a></dt>
<dd><div class="versionadded">
</div>
<p>This is the tuple of <code class="docutils literal"><span class="pre">optparse</span></code> options which will be fed into the
management command&#8217;s <code class="docutils literal"><span class="pre">OptionParser</span></code> for parsing arguments. See the
documentation for Python&#8217;s <code class="docutils literal"><span class="pre">optparse</span></code> module for more details.</p>
</dd></dl>

</div>
<div class="section" id="methods">
<h4>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h4>
<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.run_tests">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">run_tests</code><span class="sig-paren">(</span><em>test_labels</em>, <em>extra_tests=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.run_tests" title="Permalink to this definition">¶</a></dt>
<dd><p>Run the test suite.</p>
<p><code class="docutils literal"><span class="pre">test_labels</span></code> is a list of strings describing the tests to be run. A test
label can take one of three forms:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">app.TestCase.test_method</span></code> &#8211; Run a single test method in a test
case.</li>
<li><code class="docutils literal"><span class="pre">app.TestCase</span></code> &#8211; Run all the test methods in a test case.</li>
<li><code class="docutils literal"><span class="pre">app</span></code> &#8211; Search for and run all tests in the named application.</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">test_labels</span></code> has a value of <code class="docutils literal"><span class="pre">None</span></code>, the test runner should run
search for tests in all the applications in <a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>.</p>
<p><code class="docutils literal"><span class="pre">extra_tests</span></code> is a list of extra <code class="docutils literal"><span class="pre">TestCase</span></code> instances to add to the
suite that is executed by the test runner. These extra tests are run
in addition to those discovered in the modules listed in <code class="docutils literal"><span class="pre">test_labels</span></code>.</p>
<p>This method should return the number of tests that failed.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.setup_test_environment">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">setup_test_environment</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.setup_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets up the test environment ready for testing.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.build_suite">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">build_suite</code><span class="sig-paren">(</span><em>test_labels</em>, <em>extra_tests=None</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.build_suite" title="Permalink to this definition">¶</a></dt>
<dd><p>Constructs a test suite that matches the test labels provided.</p>
<p><code class="docutils literal"><span class="pre">test_labels</span></code> is a list of strings describing the tests to be run. A test
label can take one of three forms:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">app.TestCase.test_method</span></code> &#8211; Run a single test method in a test
case.</li>
<li><code class="docutils literal"><span class="pre">app.TestCase</span></code> &#8211; Run all the test methods in a test case.</li>
<li><code class="docutils literal"><span class="pre">app</span></code> &#8211; Search for and run all tests in the named application.</li>
</ul>
<p>If <code class="docutils literal"><span class="pre">test_labels</span></code> has a value of <code class="docutils literal"><span class="pre">None</span></code>, the test runner should run
search for tests in all the applications in <a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal"><span class="pre">INSTALLED_APPS</span></code></a>.</p>
<p><code class="docutils literal"><span class="pre">extra_tests</span></code> is a list of extra <code class="docutils literal"><span class="pre">TestCase</span></code> instances to add to the
suite that is executed by the test runner. These extra tests are run
in addition to those discovered in the modules listed in <code class="docutils literal"><span class="pre">test_labels</span></code>.</p>
<p>Returns a <code class="docutils literal"><span class="pre">TestSuite</span></code> instance ready to be run.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.setup_databases">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">setup_databases</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.setup_databases" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates the test databases.</p>
<p>Returns a data structure that provides enough detail to undo the changes
that have been made. This data will be provided to the <code class="docutils literal"><span class="pre">teardown_databases()</span></code>
function at the conclusion of testing.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.run_suite">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">run_suite</code><span class="sig-paren">(</span><em>suite</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.run_suite" title="Permalink to this definition">¶</a></dt>
<dd><p>Runs the test suite.</p>
<p>Returns the result produced by the running the test suite.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.teardown_databases">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">teardown_databases</code><span class="sig-paren">(</span><em>old_config</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.teardown_databases" title="Permalink to this definition">¶</a></dt>
<dd><p>Destroys the test databases, restoring pre-test conditions.</p>
<p><code class="docutils literal"><span class="pre">old_config</span></code> is a data structure defining the changes in the
database configuration that need to be reversed. It is the return
value of the <code class="docutils literal"><span class="pre">setup_databases()</span></code> method.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.teardown_test_environment">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">teardown_test_environment</code><span class="sig-paren">(</span><em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.teardown_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Restores the pre-test environment.</p>
</dd></dl>

<dl class="method">
<dt id="django.test.simple.DjangoTestSuiteRunner.suite_result">
<code class="descclassname">DjangoTestSuiteRunner.</code><code class="descname">suite_result</code><span class="sig-paren">(</span><em>suite</em>, <em>result</em>, <em>**kwargs</em><span class="sig-paren">)</span><a class="headerlink" href="#django.test.simple.DjangoTestSuiteRunner.suite_result" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes and returns a return code based on a test suite, and the result
from that test suite.</p>
</dd></dl>

</div>
</div>
<div class="section" id="module-django.test.utils">
<span id="testing-utilities"></span><h3>Testing utilities<a class="headerlink" href="#module-django.test.utils" title="Permalink to this headline">¶</a></h3>
<p>To assist in the creation of your own test runner, Django provides a number of
utility methods in the <code class="docutils literal"><span class="pre">django.test.utils</span></code> module.</p>
<dl class="function">
<dt id="django.test.utils.setup_test_environment">
<code class="descname">setup_test_environment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django.test.utils.setup_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs any global pre-test setup, such as the installing the
instrumentation of the template rendering system and setting up
the dummy email outbox.</p>
</dd></dl>

<dl class="function">
<dt id="django.test.utils.teardown_test_environment">
<code class="descname">teardown_test_environment</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#django.test.utils.teardown_test_environment" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs any global post-test teardown, such as removing the black
magic hooks into the template system and restoring normal email
services.</p>
</dd></dl>

<p>The creation module of the database backend (<code class="docutils literal"><span class="pre">connection.creation</span></code>)
also provides some utilities that can be useful during testing.</p>
<dl class="function">
<dt id="django.db.connection.creation.create_test_db">
<code class="descname">create_test_db</code><span class="sig-paren">(</span><span class="optional">[</span><em>verbosity=1</em>, <em>autoclobber=False</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#django.db.connection.creation.create_test_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Creates a new test database and runs <code class="docutils literal"><span class="pre">syncdb</span></code> against it.</p>
<p><code class="docutils literal"><span class="pre">verbosity</span></code> has the same behavior as in <code class="docutils literal"><span class="pre">run_tests()</span></code>.</p>
<p><code class="docutils literal"><span class="pre">autoclobber</span></code> describes the behavior that will occur if a
database with the same name as the test database is discovered:</p>
<ul class="simple">
<li>If <code class="docutils literal"><span class="pre">autoclobber</span></code> is <code class="docutils literal"><span class="pre">False</span></code>, the user will be asked to
approve destroying the existing database. <code class="docutils literal"><span class="pre">sys.exit</span></code> is
called if the user does not approve.</li>
<li>If autoclobber is <code class="docutils literal"><span class="pre">True</span></code>, the database will be destroyed
without consulting the user.</li>
</ul>
<p>Returns the name of the test database that it created.</p>
<p><code class="docutils literal"><span class="pre">create_test_db()</span></code> has the side effect of modifying the value of
<a class="reference internal" href="../../ref/settings.html#std:setting-NAME"><code class="xref std std-setting docutils literal"><span class="pre">NAME</span></code></a> in <a class="reference internal" href="../../ref/settings.html#std:setting-DATABASES"><code class="xref std std-setting docutils literal"><span class="pre">DATABASES</span></code></a> to match the name of the test
database.</p>
</dd></dl>

<dl class="function">
<dt id="django.db.connection.creation.destroy_test_db">
<code class="descname">destroy_test_db</code><span class="sig-paren">(</span><em>old_database_name</em><span class="optional">[</span>, <em>verbosity=1</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#django.db.connection.creation.destroy_test_db" title="Permalink to this definition">¶</a></dt>
<dd><p>Destroys the database whose name is the value of <a class="reference internal" href="../../ref/settings.html#std:setting-NAME"><code class="xref std std-setting docutils literal"><span class="pre">NAME</span></code></a> in
<a class="reference internal" href="../../ref/settings.html#std:setting-DATABASES"><code class="xref std std-setting docutils literal"><span class="pre">DATABASES</span></code></a>, and sets <a class="reference internal" href="../../ref/settings.html#std:setting-NAME"><code class="xref std std-setting docutils literal"><span class="pre">NAME</span></code></a> to the value of
<code class="docutils literal"><span class="pre">old_database_name</span></code>.</p>
<p>The <code class="docutils literal"><span class="pre">verbosity</span></code> argument has the same behavior as for
<a class="reference internal" href="#django.test.simple.DjangoTestSuiteRunner" title="django.test.simple.DjangoTestSuiteRunner"><code class="xref py py-class docutils literal"><span class="pre">DjangoTestSuiteRunner</span></code></a>.</p>
</dd></dl>

</div>
</div>
<div class="section" id="integration-with-coverage-py">
<span id="topics-testing-code-coverage"></span><h2>Integration with coverage.py<a class="headerlink" href="#integration-with-coverage-py" title="Permalink to this headline">¶</a></h2>
<p>Code coverage describes how much source code has been tested. It shows which
parts of your code are being exercised by tests and which are not. It&#8217;s an
important part of testing applications, so it&#8217;s strongly recommended to check
the coverage of your tests.</p>
<p>Django can be easily integrated with <a class="reference external" href="http://nedbatchelder.com/code/coverage/">coverage.py</a>, a tool for measuring code
coverage of Python programs. First, <a class="reference external" href="http://pypi.python.org/pypi/coverage">install coverage.py</a>. Next, run the
following from your project folder containing <code class="docutils literal"><span class="pre">manage.py</span></code>:</p>
<div class="highlight-python"><div class="highlight"><pre>coverage run --source=&#39;.&#39; manage.py test myapp
</pre></div>
</div>
<p>This runs your tests and collects coverage data of the executed files in your
project. You can see a report of this data by typing following command:</p>
<div class="highlight-python"><div class="highlight"><pre>coverage report
</pre></div>
</div>
<p>Note that some Django code was executed while running tests, but it is not
listed here because of the <code class="docutils literal"><span class="pre">source</span></code> flag passed to the previous command.</p>
<p>For more options like annotated HTML listings detailing missed lines, see the
<a class="reference external" href="http://nedbatchelder.com/code/coverage/">coverage.py</a> docs.</p>
</div>
</div>


           </div>
          </div>
	<hr/>
	<div>
		<p>扫码关注，获取更多内容</p>
		<img src="../../../../statics/img/qrcode.jpg" width="100" height="100" />
	</div>
	<!-- duoshuo start -->
	<div class="ds-thread"></div>
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"pytabdocs"};
		(function() {
			var ds = document.createElement('script');
			ds.type = 'text/javascript';ds.async = true;
			ds.src = '../../../../statics/js/duoshuo.js';
			ds.charset = 'UTF-8';
			(document.getElementsByTagName('head')[0] 
			 || document.getElementsByTagName('body')[0]).appendChild(ds);
		})();
	</script>
	<!-- duoshuo end -->
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../auth/index.html" class="btn btn-neutral float-right" title="User authentication in Django" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="doctests.html" class="btn btn-neutral" title="Django and doctests" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright Django Software Foundation and contributors.
      Last updated on Oct 24, 2016.

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.5',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   
  <script type="text/javascript" src="../../../../static/js/global.html" ></script>
  <script type="text/javascript">
        var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
        document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3F141f4ed9eb11f462fa19fdd960639134' type='text/javascript'%3E%3C/script%3E"));
  </script>
</body>

<!-- Mirrored from docs.pythontab.com/django/django1.5/topics/testing/advanced.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 04 Oct 2022 03:53:53 GMT -->
</html>